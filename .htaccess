# Configuration Apache pour Site-Vote

# Activer le moteur de réécriture
RewriteEngine On

# Autoriser l'accès aux fichiers statiques (images, CSS, JS)
<FilesMatch "\.(jpg|jpeg|png|gif|bmp|webp|css|js|svg|ico|woff|woff2|ttf|eot)$">
    Require all granted
</FilesMatch>

# Bloquer l'accès aux fichiers sensibles
<FilesMatch "\.(ini|log|sql|md)$">
    Require all denied
</FilesMatch>

# Bloquer l'accès aux répertoires sensibles
RedirectMatch 403 ^/\.git
RedirectMatch 403 ^/private
RedirectMatch 403 ^/logs
RedirectMatch 403 ^/vendor

# Protection contre les injections
<IfModule mod_rewrite.c>
    RewriteCond %{QUERY_STRING} (<|%3C).*script.*(>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|[|%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|[|%[0-9A-Z]{0,2})
    RewriteRule ^(.*)$ index.php [F,L]
</IfModule>

# Désactiver l'affichage des répertoires
Options -Indexes

# Page d'erreur personnalisée
ErrorDocument 404 /erreur.html

# Activer la compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript
</IfModule>

# Cache des fichiers statiques
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>
